SELECT
  ui_object_detail,
  EXTRACT(YEAR FROM derived_timestamp) AS run_year,
  EXTRACT(MONTH FROM derived_timestamp) AS run_month,
  EXTRACT(DAY FROM derived_timestamp) AS run_day,
  EXTRACT(HOUR FROM derived_timestamp) AS run_hour,

  -- Count of short-lived clicks
  SUM(CASE 
        WHEN interaction_type = 'SHORT_LIVED_CLICK' AND ui_action = 'clicked' THEN 1 
        ELSE 0 
      END) AS short_lived_clicks,

  -- Count of positive implicit clicks
  SUM(CASE 
        WHEN interaction_type = 'POSITIVE_IMPLICIT' AND ui_action = 'clicked' THEN 1 
        ELSE 0 
      END) AS positive_implicit_clicks,

  -- Count of not clicked rows
  SUM(CASE 
        WHEN ui_action != 'clicked' THEN 1 
        ELSE 0 
      END) AS not_clicked,

  -- Count of clicked rows
  SUM(CASE 
        WHEN ui_action = 'clicked' THEN 1 
        ELSE 0 
      END) AS clicked,

  -- Click Through Rate
  SAFE_DIVIDE(
    SUM(CASE 
          WHEN interaction_type = 'POSITIVE_IMPLICIT' AND ui_action = 'clicked' THEN 1 
          ELSE 0 
        END),
    SUM(CASE 
          WHEN ui_action = 'clicked' THEN 1 
          ELSE 0 
        END)
  ) AS click_through_rate

FROM
  search_golden_data
WHERE
  ui_object_detail IN ('transactions', 'contacts', 'reports', 'ledger_accounts', 'jump_to')
GROUP BY
  ui_object_detail,
  run_year,
  run_month,
  run_day,
  run_hour
ORDER BY
  run_year,
  run_month,
  run_day,
  run_hour;